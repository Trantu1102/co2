<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>T√≠nh v·∫øt Carbon c·ªßa B·∫°n</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      .popup-wrapper {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .popup-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 80%;
        width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        position: relative;
        animation: popupFadeIn 0.3s ease-out;
      }

      @keyframes popupFadeIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .close-btn {
        display: block;
        margin: 20px auto 0;
        padding: 10px 25px;
        background: linear-gradient(90deg, #38b000 0%, #70e000 100%);
        color: white;
        border: none;
        border-radius: 7px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.2s;
      }

      .close-btn:hover {
        background: linear-gradient(90deg, #70e000 0%, #38b000 100%);
        transform: translateY(-2px);
      }
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .container {
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
        padding: 28px 16px 24px 16px; /* Gi·∫£m padding */
        max-width: 380px; /* Gi·∫£m t·ª´ 420px xu·ªëng 380px */
        width: 100%;
        margin: 16px 0;
        animation: fadeIn 0.8s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      h1 {
        text-align: center;
        color: #2d6a4f;
        margin-bottom: 18px;
        font-size: 2rem;
        letter-spacing: 1px;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        margin-top: 12px; /* Gi·∫£m t·ª´ 16px xu·ªëng 12px */
        position: relative;
      }
      .form-label {
        display: flex;
        align-items: center;
        font-weight: 500;
        color: #264653;
        margin-bottom: 5px;
        font-size: 1.05rem;
      }
      .form-label .icon {
        font-size: 1.3em;
        margin-right: 8px;
      }
      input[type="number"],
      select {
        width: 100%;
        box-sizing: border-box;
        padding: 8px 10px; /* Gi·∫£m padding */
        margin-top: 0;
        border: 1px solid #b7c0c9;
        border-radius: 7px;
        font-size: 0.95rem;
        background: #f7fafc;
        transition: border 0.2s;
      }
      input[type="number"]:focus,
      select:focus {
        border: 1.5px solid #2d6a4f;
        outline: none;
        background: #e9f5ee;
      }
      button[type="submit"] {
        width: 100%;
        margin-top: 20px; /* Gi·∫£m margin */
        padding: 10px 0; /* Gi·∫£m padding */
        background: linear-gradient(90deg, #38b000 0%, #70e000 100%);
        color: #fff;
        font-size: 1.15rem;
        font-weight: bold;
        border: none;
        border-radius: 7px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(56, 176, 0, 0.08);
        transition: background 0.2s, transform 0.1s;
      }
      button[type="submit"]:hover {
        background: linear-gradient(90deg, #70e000 0%, #38b000 100%);
        transform: translateY(-2px) scale(1.02);
      }
      .result {
        text-align: left; /* Th√™m thu·ªôc t√≠nh n√†y */
        margin-top: 15px;
        font-size: 1.15rem;
        padding: 18px 12px;
        border-radius: 10px;
        min-height: 48px;
        background: #f1faee;
        box-shadow: 0 2px 8px rgba(44, 62, 80, 0.04);
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.5s, transform 0.5s;
        white-space: pre-line; /* Th√™m thu·ªôc t√≠nh n√†y ƒë·ªÉ gi·ªØ nguy√™n xu·ªëng d√≤ng */
      }
      .result.show {
        opacity: 1;
        transform: translateY(0);
      }
      .result .warning {
        color: #d90429;
        font-weight: bold;
      }
      .result .good {
        color: #38b000;
        font-weight: bold;
      }
      @media (max-width: 600px) {
        .container {
          padding: 10vw 2vw 10vw 2vw;
          max-width: 98vw;
        }
        h1 {
          font-size: 1.2rem;
        }
        .form-label {
          font-size: 1rem;
        }
        .result {
          font-size: 1rem;
          padding: 12px 4px;
        }
      }
      .note {
        font-size: 0.75em; /* Gi·∫£m font size */
        color: #4a5568;
        margin-top: 6px;
        margin-bottom: 2px;
        background: #f3f7fa;
        border-left: 3px solid #70e000;
        padding: 4px 8px; /* Gi·∫£m padding */
        border-radius: 5px;
        font-style: italic;
        font-weight: normal;
      }

      /* Style cho radio buttons */
      .transport-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-bottom: 15px;
      }

      .transport-radio {
        display: none;
      }

      .transport-label {
        display: flex;
        align-items: center;
        padding: 8px 12px; /* Gi·∫£m padding */
        border-radius: 8px;
        background: #f7fafc;
        border: 1px solid #e2e8f0;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.9rem; /* Gi·∫£m font size */
        color: #4a5568;
      }

      .transport-label:hover {
        background: #edf2f7;
        transform: translateY(-1px);
      }

      .transport-radio:checked + .transport-label {
        background: #38b000;
        color: white;
        border-color: #38b000;
        box-shadow: 0 2px 4px rgba(56, 176, 0, 0.1);
      }

      .transport-icon {
        margin-right: 8px;
        font-size: 1.2em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>T√≠nh v·∫øt Carbon c·ªßa B·∫°n</h1>
      <form id="carbonForm" autocomplete="off">
        <div class="form-group">
          <span class="form-label"
            ><span class="icon">üè†</span>Ti√™u th·ª• sinh ho·∫°t:</span
          >
          <input
            type="number"
            id="householdPeople"
            min="1"
            required
            placeholder="S·ªë ng∆∞·ªùi trong h·ªô"
            style="margin-bottom: 8px; width: 100%"
          />
          <div style="display: flex; gap: 10px">
            <div style="flex: 1">
              <label
                style="
                  font-weight: 500;
                  color: #264653;
                  margin-bottom: 5px;
                  display: block;
                "
                >ƒêi·ªán:</label
              >
              <input
                type="number"
                id="electricity"
                min="0"
                required
                placeholder="S·ªë kWh/th√°ng"
                style="width: 100%"
              />
              <div class="note" style="margin-top: 8px">
                <i>H·ªá s·ªë ph√°t th·∫£i ƒëi·ªán: 0,6592 kg CO‚ÇÇe/kWh</i>
              </div>
            </div>
            <div style="flex: 1">
              <label
                style="
                  font-weight: 500;
                  color: #264653;
                  margin-bottom: 5px;
                  display: block;
                "
                >N∆∞·ªõc sinh ho·∫°t:</label
              >
              <input
                type="number"
                id="water"
                min="0"
                required
                placeholder="S·ªë m¬≥/th√°ng"
                style="width: 100%"
              />
              <div class="note" style="margin-top: 8px">
                <i>H·ªá s·ªë ph√°t th·∫£i trung b√¨nh c·ªßa n∆∞·ªõc: 0,5 kg CO‚ÇÇe/m¬≥</i>
              </div>
            </div>
            <div style="flex: 1">
              <label
                style="
                  font-weight: 500;
                  color: #264653;
                  margin-bottom: 5px;
                  display: block;
                "
                >R√°c th·∫£i:</label
              >
              <input
                type="number"
                id="trash"
                min="0"
                required
                placeholder="S·ªë kg/th√°ng"
                style="width: 100%"
              />
              <div class="note" style="margin-top: 8px">
                <i>H·ªá s·ªë ph√°t th·∫£i trung b√¨nh c·ªßa r√°c: 2 kg CO‚ÇÇe/kg</i>
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <span class="form-label"
            ><span class="icon">üöó</span>Giao th√¥ng ƒëi l·∫°i:</span
          >

          <!-- Th√™m ph·∫ßn checkbox -->
          <div class="transport-options">
            <input
              type="radio"
              id="walking"
              name="transportType"
              value="walking"
              class="transport-radio"
            />
            <label for="walking" class="transport-label">
              <span class="transport-icon">üö∂</span>
              ƒêi b·ªô
            </label>

            <input
              type="radio"
              id="personal"
              name="transportType"
              value="personal"
              class="transport-radio"
              checked
            />
            <label for="personal" class="transport-label">
              <span class="transport-icon">üöó</span>
              Ph∆∞∆°ng ti·ªán c√° nh√¢n
            </label>

            <input
              type="radio"
              id="public"
              name="transportType"
              value="public"
              class="transport-radio"
            />
            <label for="public" class="transport-label">
              <span class="transport-icon">üöå</span>
              Ph∆∞∆°ng ti·ªán c√¥ng c·ªông
            </label>

            <input
              type="radio"
              id="both"
              name="transportType"
              value="both"
              class="transport-radio"
            />
            <label for="both" class="transport-label">
              <span class="transport-icon">üöóüöå</span>
              S·ª≠ d·ª•ng c·∫£ hai lo·∫°i
            </label>
          </div>

          <div style="display: flex; gap: 10px; margin-top: 8px">
            <div style="flex: 1">
              <label
                style="
                  font-weight: 500;
                  color: #264653;
                  margin-bottom: 5px;
                  display: block;
                "
                >Ph∆∞∆°ng ti·ªán c√° nh√¢n:</label
              >
              <select id="vehicleType" style="width: 100%">
                <option value="bicycle">Xe ƒë·∫°p üö≤</option>
                <option value="motor_gas">Xe m√°y xƒÉng üõµ</option>
                <option value="motor_electric">Xe m√°y ƒëi·ªán &#128756;</option>
                <option value="car_gas">√î t√¥ xƒÉng &#128663;</option>
                <option value="car_electric">√î t√¥ ƒëi·ªán &#128665;</option>
              </select>
              <input
                type="number"
                id="kmPerDay"
                min="0"
                required
                placeholder="S·ªë km/ng√†y"
                style="margin-top: 8px; width: 100%"
              />
              <input
                type="number"
                id="vehiclePeople"
                min="1"
                required
                placeholder="S·ªë ng∆∞·ªùi tr√™n xe"
                style="margin-top: 8px; width: 100%"
              />
            </div>
            <div style="flex: 1">
              <label
                style="
                  font-weight: 500;
                  color: #264653;
                  margin-bottom: 5px;
                  display: block;
                "
                >Ph∆∞∆°ng ti·ªán c√¥ng c·ªông:</label
              >
              <select id="publicTransport" style="width: 100%">
                <option value="bus_gas">Xe bu√Ωt xƒÉng üöå</option>
                <option value="bus_electric">Xe bu√Ωt ƒëi·ªán üöé</option>
              </select>
              <input
                type="number"
                id="publicKmPerDay"
                min="0"
                required
                placeholder="S·ªë km/ng√†y"
                style="margin-top: 8px; width: 100%"
              />
              <div
                style="
                  height: 42px;
                  margin-top: 8px;
                  font-size: 0.9em;
                  color: #666;
                "
              >
                (S·ªë ng∆∞·ªùi trung b√¨nh: 45 ng∆∞·ªùi/xe)
              </div>
            </div>
          </div>
          <div class="note">
            <i
              >H·ªá s·ªë ph√°t th·∫£i xƒÉng: 2,31 kg CO‚ÇÇe/l√≠t<br />
              H·ªá s·ªë ph√°t th·∫£i ƒëi·ªán l∆∞·ªõi: 0,6592 kg CO‚ÇÇe/kWh<br />
              ƒêi b·ªô/ƒê·∫°p xe: 0 kg CO‚ÇÇe</i
            >
          </div>
        </div>
        <div class="form-group">
          <span class="form-label"><span class="icon">üçΩÔ∏è</span>ƒÇn u·ªëng:</span>
          <select id="diet">
            <option value="red_meat">ƒÇn nhi·ªÅu th·ªãt ƒë·ªè ü•©</option>
            <option value="balanced">ƒÇn c√¢n b·∫±ng üçóü•¶</option>
            <option value="vegetarian">ƒÇn chay ü•ó</option>
          </select>
          <div class="note">
            <i
              >ƒÇn nhi·ªÅu th·ªãt ƒë·ªè: 200 kg CO‚ÇÇe/th√°ng<br />ƒÇn c√¢n b·∫±ng: 100 kg
              CO‚ÇÇe/th√°ng<br />ƒÇn chay: 60 kg CO‚ÇÇe/th√°ng</i
            >
          </div>
        </div>
        <div class="form-group">
          <span class="form-label"
            ><span class="icon">üõí</span>Mua s·∫Øm, ti√™u d√πng:</span
          >
          <select id="shopping">
            <option value="low">√çt mua s·∫Øm &#128085;</option>
            <option value="normal">Mua s·∫Øm b√¨nh th∆∞·ªùng &#128087;</option>
            <option value="high">Th∆∞·ªùng xuy√™n mua s·∫Øm &#128090;</option>
          </select>
          <div class="note">
            <i
              >√çt mua s·∫Øm: 15 kg CO‚ÇÇe/th√°ng<br />B√¨nh th∆∞·ªùng: 30 kg
              CO‚ÇÇe/th√°ng<br />Th∆∞·ªùng xuy√™n: 60 kg CO‚ÇÇe/th√°ng</i
            >
          </div>
        </div>
        <button type="submit">K·∫øt qu·∫£</button>
      </form>

      <div class="popup-wrapper" id="popupWrapper">
        <div class="popup-content">
          <div class="result" id="result"></div>
          <button class="close-btn">ƒê√≥ng</button>
        </div>
      </div>
    </div>
    <script>
      document.getElementById("carbonForm").onsubmit = async function (e) {
        e.preventDefault();
        try {
          const resultDiv = document.getElementById("result");
          const popupWrapper = document.getElementById("popupWrapper");

          // Th√™m validation
          if (!document.querySelector('input[name="transportType"]:checked')) {
            alert("Vui l√≤ng ch·ªçn ph∆∞∆°ng ti·ªán di chuy·ªÉn");
            return;
          }

          // L·∫•y c√°c gi√° tr·ªã input v√† t√≠nh to√°n
          const householdPeople = Number(
            document.getElementById("householdPeople").value
          );
          const kwh = Number(document.getElementById("electricity").value);
          const water = Number(document.getElementById("water").value);
          const trash = Number(document.getElementById("trash").value);

          // Ki·ªÉm tra gi√° tr·ªã h·ª£p l·ªá
          if (!householdPeople || !kwh || !water || !trash) {
            alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ti√™u th·ª• sinh ho·∫°t");
            return;
          }

          // T√≠nh to√°n carbon ƒëi·ªán
          const carbonElectric = (kwh / householdPeople) * 0.6592;

          // T√≠nh to√°n carbon giao th√¥ng
          let carbonTransport = 0;
          let carbonPublicTransport = 0;
          const transportType = document.querySelector(
            'input[name="transportType"]:checked'
          ).value;

          if (transportType === "walking") {
            carbonTransport = 0; // ƒêi b·ªô kh√¥ng ph√°t th·∫£i
          } else {
            if (transportType === "personal" || transportType === "both") {
              const vehicle = document.getElementById("vehicleType").value;
              const kmPerDay = Number(
                document.getElementById("kmPerDay").value
              );
              const vehiclePeople = Number(
                document.getElementById("vehiclePeople").value
              );

              if (!kmPerDay || !vehiclePeople) {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ph∆∞∆°ng ti·ªán c√° nh√¢n");
                return;
              }

              // T√≠nh to√°n d·ª±a tr√™n lo·∫°i ph∆∞∆°ng ti·ªán
              switch (vehicle) {
                case "motor_gas":
                  carbonTransport =
                    ((kmPerDay / 100) * 2.5 * 30 * 2.31) / vehiclePeople;
                  break;
                case "motor_electric":
                  carbonTransport =
                    (kmPerDay * 30 * 0.0345 * 0.6592) / vehiclePeople;
                  break;
                case "car_gas":
                  carbonTransport =
                    ((kmPerDay / 100) * 8 * 30 * 2.31) / vehiclePeople;
                  break;
                case "car_electric":
                  carbonTransport =
                    (kmPerDay * 30 * 0.2 * 0.6592) / vehiclePeople;
                  break;
              }
            }

            if (transportType === "public" || transportType === "both") {
              const publicTransport =
                document.getElementById("publicTransport").value;
              const publicKmPerDay = Number(
                document.getElementById("publicKmPerDay").value
              );

              if (!publicKmPerDay) {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ph∆∞∆°ng ti·ªán c√¥ng c·ªông");
                return;
              }

              const publicPeople = 45;
              if (publicTransport === "bus_gas") {
                carbonPublicTransport =
                  ((publicKmPerDay / 100) * 25 * 30 * 2.31) / publicPeople;
              } else if (publicTransport === "bus_electric") {
                carbonPublicTransport =
                  (publicKmPerDay * 30 * 1.0 * 0.6592) / publicPeople;
              }
            }
          }

          // T√≠nh to√°n c√°c gi√° tr·ªã kh√°c
          const carbonWater = (water * 0.5) / householdPeople;
          const carbonTrash = (trash * 2) / householdPeople;

          const diet = document.getElementById("diet").value;
          const carbonDiet =
            diet === "red_meat" ? 200 : diet === "balanced" ? 100 : 60;

          const shopping = document.getElementById("shopping").value;
          const carbonShopping =
            shopping === "low" ? 15 : shopping === "normal" ? 30 : 60;

          // T√≠nh t·ªïng
          const total =
            carbonElectric +
            carbonTransport +
            carbonPublicTransport +
            carbonDiet +
            carbonShopping +
            carbonWater +
            carbonTrash;

          let message = `T·ªïng ph√°t th·∫£i CO‚ÇÇe c·ªßa b·∫°n trong th√°ng: <b>${total.toFixed(
            2
          )} kg</b>.<br>`;
          message +=
            total > 168
              ? '<span class="warning">B·∫°n c·∫ßn gi·∫£m ph√°t th·∫£i ƒë·ªÉ b·∫£o v·ªá m√¥i tr∆∞·ªùng!</span>'
              : '<span class="good">T·ªët l·∫Øm! H√£y duy tr√¨ l·ªëi s·ªëng xanh!</span>';

          // Ensure popup is shown before loading advice
          resultDiv.innerHTML = message;
          popupWrapper.style.display = "flex";
          resultDiv.classList.add("show");

          // X·ª≠ l√Ω ƒë√≥ng popup
          const closeBtn = document.querySelector(".close-btn");
          closeBtn.onclick = () => (popupWrapper.style.display = "none");
          popupWrapper.onclick = (e) => {
            if (e.target === popupWrapper) popupWrapper.style.display = "none";
          };
        } catch (error) {
          console.error("Error in form submission:", error);
          alert("C√≥ l·ªói x·∫£y ra: " + error.message);
        }
      };

      // Th√™m function x·ª≠ l√Ω enable/disable fields
      function handleTransportTypeChange() {
        const transportType = document.querySelector(
          'input[name="transportType"]:checked'
        ).value;
        const personalFields = document.querySelectorAll(
          "#vehicleType, #kmPerDay, #vehiclePeople"
        );
        const publicFields = document.querySelectorAll(
          "#publicTransport, #publicKmPerDay"
        );

        // X·ª≠ l√Ω c√°c tr∆∞·ªùng ph∆∞∆°ng ti·ªán c√° nh√¢n
        personalFields.forEach((field) => {
          if (transportType === "public" || transportType === "walking") {
            field.disabled = true;
            field.style.opacity = "0.5";
            if (field.tagName === "INPUT") field.value = "";
          } else {
            field.disabled = false;
            field.style.opacity = "1";
          }
        });

        // X·ª≠ l√Ω c√°c tr∆∞·ªùng ph∆∞∆°ng ti·ªán c√¥ng c·ªông
        publicFields.forEach((field) => {
          if (transportType === "personal" || transportType === "walking") {
            field.disabled = true;
            field.style.opacity = "0.5";
            if (field.tagName === "INPUT") field.value = "";
          } else {
            field.disabled = false;
            field.style.opacity = "1";
          }
        });
      }

      // Th√™m event listeners
      document
        .querySelectorAll('input[name="transportType"]')
        .forEach((radio) => {
          radio.addEventListener("change", handleTransportTypeChange);
        });

      // G·ªçi function l·∫ßn ƒë·∫ßu ƒë·ªÉ set tr·∫°ng th√°i m·∫∑c ƒë·ªãnh
      handleTransportTypeChange();

      console.log("Submit button clicked");
      console.log("Popup elements:", {
        resultDiv: document.getElementById("result"),
        popupWrapper: document.getElementById("popupWrapper"),
      });
    </script>
  </body>
</html>
